---
layout: post
title: 横切与 Golang
category: 技术
keywords: 架构,AOP,横切,Golang,go,设计模式
comments:  true
notshow: true
---


AOP，Aspect Oriented Programming --- 面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。
（注意，AOP通过【预编译】和【代理】两种方式实现的程序功能的统一维护）
用更简单的话说，AOP 可以理解为在方法执行前后可以去完成相同的业务逻辑。

作为一种编程思想，AOP 站在了与 OOP 不同的另一种角度。

OOP 是将一系列行为抽象成对象去管理，一个更拟生的对象思维。
AOP 是将共通的行为摘成模块去使用，一个更功能化的思维。

既然是思想，那 AOP 就不会被限制于技术领域。其实在业务领域也能够使用 AOP 的思想去实现。
为什么我们要和 OOP，做比较呢？因为这样比较好懂。但是 AOP 和 OOP 并不对立，他们是相辅相成的。
接下来我们举个`日志`的例子体会下：

OOP 思想
---
> 我们会实现一个日志类，然后在所有需要的模块中引用这个类（import），很有可能这个类会成为一个我们的第三方包。
 
看起来很美好是不是，这样实现其实有个很明显的问题（问题很多都是共通的），如果我们需要动态扩展日志功能的话，是不是面临着复杂的包管理？只要使用到该功能的模块都会需要升级（甚至有些还不能随便升，导致版本出现了差异）。

AOP 思想
---
日志对于我们来说也是一个功能逻辑，每次执行都调用同样的功能就好了嘛。
规定在代码执行到某个点的时候，记录日志。


OOP 注重的是业务逻辑上的单元划分。而 AOP 注重的是业务处理过程中的行为划分。

这里就有个疑问了，`既然这样，有没有想到微服务？`

对于我来说，我能够想到的解决方法就是将日志功能拿出来作为一个 RPC 的微服务去管理。

其实 AOP 的这种方法对比 RPC 微服务化还是有很大区别的。
一般的 RPC 调用我都要知道输入输出，并且要主动调用方法，
模块中依然需要加入 RPC 定义。而 AOP 则不需要，

AOP 是思想，是思想，是思想。
一般我们把业务无关的逻辑用 AOP 去实现。而实现的常用手段有代理，或者拦截（我觉得又是相似的~）。

其实说到 AOP，联想最多的是 Java。
我认为，正式因为 Java 有虚拟机与字节码的存在，所以使得 AOP 可以从一个更低层面去实现。

比如，我们常常会听到动态横切（织入），静态横切（织入）。
这是啥呢？

动态横切

> 在运行期，目标类加载后，为接口动态生成代理类，将切面植入到代理类中。相对于静态AOP更加灵活。但切入的关注点需要实现接口。对系统有一点性能影响。

静态横切

> 在编译期织入，切面直接以字节码的形式编译到目标字节码文件中，这要求使用特殊的 Java 编译器。
> 在类装载期织入，这要求使用特殊的类装载器。

这两个横切可以说都是建立在Java虚拟机的基础上的。


## 参考
---
- <https://juejin.im/post/5c01533de51d451b80257752>
- <https://stackoverflow.com/questions/242177/what-is-aspect-oriented-programming>
- <http://bitdewy.github.io/blog/2013/10/20/aop/>
- <https://www.jianshu.com/p/5df1fefcba45>
- <https://blog.csdn.net/heyeqingquan/article/details/71600676>